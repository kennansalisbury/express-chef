<% let cookPrepTime = recipe.totalTime ? recipe.totalTime : time %>

<h1>Show 1 Recipe from Search Results</h1>

<h2><%= recipe.label %></h2>

<p><%= instructionsText %></p>

<p>Ingredients:</p>
<p><%= recipe.ingredients[0].text%> </p>

<p><%= cookPrepTime %></p>

<button id='save-btn' href="#save">Save Recipe</button>

<form id="save-form" method="POST" action="/recipes">
    <input type="hidden" name="title" value="<%= recipe.label %>">
    <input type="hidden" name="source" value="<%= recipe.source %>">
    <input type="hidden" name="sourceUrl" value="<%= recipe.url %>">
    <input type="hidden" name="imageUrl" value="<%= recipe.image %>">
    <input type="hidden" name="time" value="<%= cookPrepTime %>">
    <input type="hidden" name="servings" value="<%= recipe.yield %>">
    <input type="hidden" name="ingredientsText" value="<%= recipe.ingredientLines %>">
    <input type="hidden" name="ingredients" value="<%= JSON.stringify(recipe.ingredients) %>">
    <input type="hidden" name="instructionsText" value="<%= instructionsText %>">
    <input type="hidden" name="instructions" value="<%= JSON.stringify(instructionsObj)%>">
    <input type="hidden" name="type" value="<%= JSON.stringify(type) %>">
    <input type="hidden" name="diet" value="<%= JSON.stringify(recipe.dietLabels) %>">
    <input type="hidden" name="health" value="<%= JSON.stringify(recipe.healthLabels) %>">
    <input type="hidden" name="calories" value="<%= recipe.calories %>">

    <div id="add-categories" class="hide">
        <h3>Categorize (optional):</h3>


        <% if (categories) {%>
            <h4>Existing categories:</h4>
            
            <% categories.forEach(category => { %>
                <input type="checkbox" name="existing_categories" value="<%=category.name%>">
                <label><%=category.name%></label>
            <% }) %>

            <h4>Add your own categories</h4>

        <%} else {%>
        <h4> You don't have any categories stored yet, start by adding some new ones below!</h4>
        <%}%>

        <label>Add categories by submitting below. Categories should be separated by commas.</label>
        <input type="text" name="new_categories" placeholder="i.e. breakfast, lunch, dinner, etc. ">

    </div>

    <input type="submit" id="submit-btn" class="hide" value="Save Recipe">

</form>

<script>
    document.getElementById('save-btn').addEventListener('click', () => {
        if(document.getElementById('add-categories').getAttribute('class') === 'hide'){
            document.getElementById('add-categories').setAttribute('class', 'show')
            document.getElementById('submit-btn').setAttribute('class', 'show')
            document.getElementById('save-btn').textContent = 'Hide'
        } else {
            document.getElementById('add-categories').setAttribute('class', 'hide')
            document.getElementById('submit-btn').setAttribute('class', 'hide')
            document.getElementById('save-btn').textContent = 'Save Recipe'
        }
    })
</script>